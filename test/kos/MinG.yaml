meta:
  project_name: "kos"
  project_version: v0.1

cache:
  prj:
    m2: ${USER_HOME}/.m2
    gradle: ${USER_HOME}/.gradle
    npm: ${WORK_ROOT}/app/node_modules
  tmp:
    pass_package:

build:
  dockerfile: MinG.Build.Dockerfile
  arg:
    - IMAGE_NAME=gradle
    - IMAGE_VERSION=5.0.0-jdk8
  lifecycle: preserve
  env:
    - JDK_VERSION=1.8
    - GRADLE_VERSION=5.0
  volume:
    - m2
    - gradle
    - npm
  exec:
    - action: copy_in
      value: ["volume, credential, gradle.properteis, ${USER_HOME}/.gradle/gradle.properties"]
    - action: command
      value: ["gradle clean"]
    - action: command
      value: ["gradle yarn", "gradle build"]
    - action: copy_out
      value: ["volume, credential, ${USER_HOME}/.gradle/gradle.properties, gradle.properties"]
  extract:
    kos_pkg: /application/app/build/libs/app.jar

deploy:
  dockerfile: MinG.Deploy.Dockerfile
  arg:
    - JDK_VERSION=1.8
    - GRADLE_VERSION=5.0
    - APP_VERSION=20190111
  inject: # ADD
    kos_pkg: /application/app.jar
  entrypoint: ["java","-Djava.security.egd=file:/dev/./urandom","-jar","/application/app.jar"]
  push_to:
    - target: docker
      url: hub.docker.com
      name: scriptonbasestar/deploy_kos:20190111
